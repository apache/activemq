<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns:amq="http://activemq.org/config/1.0">

    <amq:broker brokerName="brokerJournalConfigTest" persistent="false" useShutdownHook="false" deleteAllMessagesOnStartup="true">

        <amq:transportConnectors>
            <amq:transportConnector uri="tcp://localhost:61635"/>
        </amq:transportConnectors>

        <amq:persistenceAdapter>
            <amq:journalPersistenceAdapter>
                <constructor-arg index="0">
                    <ref bean="myJournalImpl"/>
                </constructor-arg>

                <constructor-arg index="1">
                    <amq:jdbcPersistenceAdapter>
                        <property name="cleanupPeriod" value="60000"/>
                        <property name="dataSource" ref="embedded-ds"/>
                        <property name="wireFormat">
                            <bean id="myWireFormat" class="org.activeio.command.DefaultWireFormat"/>
                        </property>
                    </amq:jdbcPersistenceAdapter>
                </constructor-arg>

                <constructor-arg index="2">
                    <amq:usageManager/>
                </constructor-arg>

                <constructor-arg index="3">
                    <bean id="myTaskRunnerFactory" class="org.activemq.thread.TaskRunnerFactory"/>
                </constructor-arg>
            </amq:journalPersistenceAdapter>
        </amq:persistenceAdapter>
    </amq:broker>

    <!-- The journal implementation that will be used -->
    <bean id="myJournalImpl" class="org.activeio.journal.active.JournalImpl">
        <constructor-arg index="0">
            <bean id="myFile" class="java.io.File">
                <constructor-arg index="0">
                    <value>target/test-data/testJournalConfig/journal</value>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

    <!-- The Datasource that will be used by the Broker -->
    <bean id="embedded-ds" class="org.apache.derby.jdbc.EmbeddedDataSource">
        <property name="databaseName" value="testJournalConfig/derbydb"/>
        <property name="createDatabase" value="create"/>
    </bean>
</beans>
