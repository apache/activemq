package org.apache.activemq.util;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Arrays;

public class LRUKCacheTest {

    protected static final Logger LOG = LoggerFactory.getLogger(LRUKCacheTest.class);

    @Test
    public void testPut(){
        LRUKCache<Integer, Integer> lrukCache = new LRUKCache<>();
        int[] array = {90, 10, 40, 79, 39, 54, 53, 18, 61, 60, 63, 80, 89, 20, 78, 44, 76, 25, 29, 57};
        for (int i = 0; i < array.length; i++) {
            lrukCache.put(array[i], array[i]);
        }
    }

    @Test
    public void testGet(){
        LRUKCache<Integer, Integer> lrukCache = new LRUKCache<>();
        int[] array = {90, 10, 40, 79, 39, 54, 53, 18, 61, 60, 63, 80, 89, 20, 78, 44, 76, 25, 29, 57};

        for (int i = 0; i < array.length; i++) {
            lrukCache.put(array[i], array[i]);
        }

        for (int i = 0; i < array.length; i++) {
            int j = 7;
            while (j > 0){
                Assert.assertEquals((int)lrukCache.get(array[i]), array[i]);
                Assert.assertTrue(lrukCache.containsKey(array[i]));
                Assert.assertTrue(lrukCache.containsValue(array[i]));
                j--;
            }
        }
    }

    @Test
    public void testRemove(){
        LRUKCache<Integer, Integer> lrukCache = new LRUKCache<>();
        int[] array = {90, 10, 40, 79, 39, 54, 53, 18, 61, 60, 63, 80, 89, 20, 78, 44, 76, 25, 29, 57};

        for (int i = 0; i < array.length; i++) {
            lrukCache.put(array[i], array[i]);
        }

        for (int i = 0; i < array.length; i++) {
            int j = 7;
            while (j > 0){
                Assert.assertEquals((int)lrukCache.get(array[i]), array[i]);
                j--;
            }
        }

        for (int i = 0; i < array.length; i++) {
            Assert.assertTrue(lrukCache.containsValue(array[i]));
            lrukCache.remove(array[i]);
            Assert.assertTrue(!lrukCache.containsValue(array[i]));
        }
    }

    @Test
    public void testEvict1() {
        LRUKCache<Integer, Integer> lrukCache = new LRUKCache<>(1000, 2);
        int[] array = {5530, 6886, 5651, 7698, 4672, 9078, 3419, 9096, 9363, 1826, 2411, 1263, 4520, 9529, 9401, 193, 4452, 934, 3175, 8598, 915, 3168, 4580, 7896, 4492, 2377, 3690, 6038, 7773, 6487, 3411, 4797, 9584, 1121, 5377, 4155, 4654, 4717, 7971, 1676, 229, 65, 8158, 2236, 1105, 6909, 8461, 4796, 9812, 1402, 9029, 41, 2069, 5984, 5442, 5758, 2347, 9378, 3647, 2810, 4519, 1060, 1010, 9270, 9845, 9511, 5921, 4101, 9758, 731, 7505, 7486, 6829, 5630, 8978, 9520, 6588, 5308, 1112, 6638, 1474, 1118, 5077, 293, 8311, 128, 3197, 5846, 8966, 5991, 8798, 270, 5561, 329, 2019, 157, 8394, 2327, 5710, 6578, 4278, 1412, 5353, 1501, 4869, 7361, 8109, 5406, 8209, 8972, 8436, 2629, 4406, 1950, 5798, 2193, 7758, 4698, 5381, 1364, 8346, 5129, 7894, 9965, 8256, 1877, 4072, 9920, 426, 6768, 59, 5393, 4126, 1356, 1494, 810, 8212, 3142, 3054, 8154, 3962, 5839, 7540, 8604, 1288, 8985, 8658, 8565, 3076, 5985, 5026, 1517, 7238, 3238, 5671, 2286, 1023, 5552, 5505, 4148, 6456, 514, 1477, 5259, 176, 7012, 8828, 3245, 6039, 8495, 4503, 2953, 5541, 7636, 7277, 7641, 8091, 7160, 5657, 8410, 1924, 8366, 2398, 9815, 4241, 2537, 4458, 8913, 7732, 2590, 7149, 5478, 3379, 8252, 2868, 5896, 6644, 3886, 4509, 5485, 3230, 9788, 1992, 5931, 9534, 8010, 9025, 3263, 4918, 3768, 8669, 2456, 4898, 6473, 4750, 7869, 3825, 6521, 8365, 5682, 8937, 4711, 7130, 8572, 6903, 9116, 3674, 6273, 603, 6366, 7200, 9572, 4780, 230, 4352, 3775, 7291, 2824, 7498, 7609, 2978, 5722, 2775, 3023, 9424, 1708, 3584, 2737, 1743, 664, 2455, 8453, 6695, 4159, 9161, 3941, 6766, 8967, 4972, 2059, 5842, 8032, 6282, 741, 6686, 3029, 3874, 2640, 7911, 8758, 5595, 6534, 1957, 1897, 289, 925, 6458, 7688, 1960, 3294, 8616, 4901, 2718, 3003, 4428, 6948, 4835, 9560, 2993, 9855, 6012, 8850, 1176, 3524, 7059, 8165, 7976, 4401, 4557, 4967, 4226, 8208, 4902, 8670, 9983, 3516, 4353, 3208, 6336, 389, 1172, 875, 2842, 466, 3384, 1119, 9527, 5962, 3359, 1915, 53, 1900, 7140, 9440, 6386, 1220, 5937, 1378, 1520, 2711, 1362, 4836, 4414, 7834, 7818, 9119, 6387, 5981, 6847, 1138, 8692, 3283, 3574, 2794, 4009, 9162, 6332, 8205, 1607, 6242, 4636, 2303, 2288, 1222, 4337, 1518, 6887, 7723, 5960, 7239, 5382, 1576, 6253, 2271, 2563, 3192, 8664, 799, 7114, 1812, 2255, 2923, 4889, 222, 8795, 7290, 9157, 3443, 1940, 5906, 7571, 5753, 793, 8830, 6938, 3467, 4147, 3996, 5469, 7568, 7473, 3408, 4774, 2017, 8471, 6907, 9374, 1713, 4010, 5899, 6005, 8048, 2677, 4448, 6663, 6324, 947, 4996, 822, 9713, 1475, 8889, 7251, 9710, 1810, 7899, 5204, 9288, 6892, 8829, 855, 5486, 4237, 7569, 1975, 8286, 4244, 32, 5908, 210, 9605, 8260, 1999, 5966, 1116, 1698, 2599, 3816, 8306, 4431, 4487, 6915, 6370, 3736, 2500, 843, 1561, 9681, 2753, 2161, 6482, 6639, 3281, 4272, 2696, 7196, 9308, 6677, 2840, 6317, 1047, 1720, 3661, 7766, 6779, 3457, 3573, 8977, 9487, 3319, 2043, 1854, 4895, 4597, 2659, 3170, 4051, 872, 3545, 6542, 249, 6591, 7994, 7065, 9407, 2295, 9952, 1911, 4269, 2156, 9097, 4995, 2194, 4890, 7086, 1287, 3139, 9924, 4840, 6765, 9552, 9518, 4693, 5692, 1409, 7002, 2567, 8838, 619, 1603, 3808, 3828, 1509, 7787, 5289, 4243, 9172, 820, 9523, 1690, 3667, 6211, 4649, 3150, 5352, 4115, 3968, 8935, 5598, 4980, 9008, 2473, 5718, 1904, 6320, 907, 4356, 964, 7460, 2078, 1694, 8349, 4037, 1767, 4329, 6825, 718, 657, 1131, 564, 856, 3067, 1782, 7467, 6172, 2504, 7258, 2495, 5808, 6865, 8275, 8455, 7482, 177, 4128, 6531, 1748, 8988, 9117, 5458, 6227, 828, 1493, 1848, 7977, 1771, 8126, 185, 3484, 2165, 1104, 5662, 4265, 1856, 9791, 1979, 2985, 5817, 2524, 2431, 4965, 2261, 9698, 817, 3650, 9250, 5449, 1550, 1329, 4761, 4005, 9727, 753, 4390, 428, 2393, 4744, 1065, 7020, 3204, 4098, 6816, 9985, 215, 5890, 877, 2445, 5090, 3871, 3800, 4343, 3299, 4371, 3397, 5421, 8981, 3593, 6270, 5804, 4746, 9305, 9634, 2855, 8057, 2565, 6817, 3620, 9417, 9653, 3132, 3088, 4846, 5631, 5392, 6432, 5893, 8780, 4270, 9944, 9124, 9095, 7984, 9332, 7122, 4079, 5306, 1087, 9918, 3195, 2243, 4827, 42, 9307, 2611, 9113, 8477, 9603, 1571, 3146, 8498, 3931, 8295, 627, 4099, 6011, 8877, 9717, 7880, 1885, 9565, 2429, 7630, 9573, 5389, 1215, 3047, 4610, 261, 7310, 3906, 2336, 5058, 9587, 3356, 2772, 3671, 6799, 2341, 3470, 3610, 6780, 6213, 7837, 1622, 1931, 7640, 1113, 7495, 3410, 6971, 3252, 2218, 5754, 7340, 2898, 2949, 6687, 385, 1890, 9431, 7168, 5125, 2200, 9428, 8271, 8568, 9160, 989, 8754, 7404, 2580, 3677, 3405, 4669, 2553, 7479, 6111, 3656, 6131, 37, 1435, 7856, 5838, 7217, 901, 8072, 4559, 5711, 2825, 3704, 7248, 3333, 8846, 8059, 1737, 1319, 480, 199, 7551, 9285, 5737, 7328, 1620, 2259, 5877, 1932, 2556, 3500, 9199, 740, 535, 3537, 1943, 8557, 8476, 764, 1483, 4888, 1563, 630, 3652, 7157, 9253, 4753, 821, 2998, 213, 7657, 7666, 5588, 3780, 4063, 444, 9219, 8808, 8545, 4985, 9075, 8743, 4703, 5230, 9248, 2709, 9930, 4939, 1724, 8087, 8080, 6628, 5925, 1813, 4751, 5855, 1306, 6516, 2911, 8467, 281, 316, 575, 4710, 8217, 6838, 4569, 2514, 8661, 1394, 3396, 680, 5524, 3160, 445, 7481, 3818, 1259, 67, 6032, 6333, 2545, 2008, 9455, 260, 7285, 3710, 4306, 113, 6752, 8611, 9413, 9519, 6401, 3980, 3255, 3183, 5275, 2148, 5043, 4832, 1821, 4170, 56, 1702, 1196, 8627, 4609, 9236, 4691, 7128, 2252, 2332, 7965, 1828, 1948, 4261, 3028, 4697, 4474, 4525, 7958, 1721, 3830, 5139, 163, 7322, 4327, 7075, 3691, 4632, 332, 5685, 4907, 2489, 7064, 7642, 1985, 4070, 7898, 1054, 9296, 5333, 3988, 4809, 3963, 4156, 2721, 9073, 5462, 9895, 6719, 8879, 2521, 7992, 3515, 4423, 6848, 2926, 6239, 3782, 7544, 4781, 9595, 1272, 5654, 1308, 4418, 2633, 8840, 1086, 7554, 7923, 9813, 8442, 2643, 4680, 7993, 340, 6803, 7089, 9489, 7024, 8760, 8505, 9564, 7601, 1482, 2311, 5013, 7046, 2505, 3543, 6479, 218, 5074, 3348, 2454, 7813, 7542, 6846, 9311, 6884, 7549, 7757, 529, 9037, 2909, 7094, 8189, 9505, 1289, 145, 3259, 9465, 2661, 7382, 4194, 4713, 8733, 7663, 940, 8246, 3049, 3738, 3678, 7808, 8107, 5002, 9645, 1565, 1484, 4228, 4254, 7199, 7728, 1369, 3726, 8570, 4759, 2400, 4650, 4966};

        for (int i = 0; i < 500; i++) {
            lrukCache.put(array[i], array[i]);
        }

        for (int i = 0; i < 500; i++) {
            int j = 2;
            while (j > 0){
                lrukCache.get(array[i]);
                j--;
            }
        }

        for (int i = 500; i < 1000; i++) {
            lrukCache.put(array[i], array[i]);
        }

        for(int i = 0; i < 1000; i++) {
           Assert.assertTrue(lrukCache.containsKey(array[i]));
        }
    }


}
